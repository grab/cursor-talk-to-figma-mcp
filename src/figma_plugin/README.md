# Figma Plugin Source Structure

This directory contains the Figma plugin code with a modular architecture.

## Directory Structure

```
figma_plugin/
├── dist/                # Build output
│   └── code.js         # Bundled output (generated by build.js)
├── manifest.json        # Figma plugin manifest
├── ui.html             # Plugin UI
├── build.js            # Build script using esbuild
├── src/
│   └── main.js         # Main entry point (imports all handlers)
├── handlers/           # Command handler modules
│   ├── index.js        # Central export for all handlers
│   ├── annotationHandlers.js
│   ├── componentHandlers.js
│   ├── connectorHandlers.js
│   ├── layoutHandlers.js
│   ├── nodeCreators.js
│   ├── nodeModifiers.js
│   ├── nodeReaders.js
│   ├── stylingHandlers.js
│   └── textHandlers.js
└── utils/              # Utility modules
    ├── index.js        # Central export for all utilities
    ├── colorUtils.js
    ├── exportUtils.js
    ├── helpers.js
    ├── nodeUtils.js
    ├── progressUtils.js
    └── textUtils.js
```

## Build Commands

From the project root:

```bash
# Build the Figma plugin (generates code.js from modular source)
npm run plugin:build

# Watch mode for development
npm run plugin:watch

# Build both MCP server and Figma plugin
npm run build:all
```

## Handler Modules

| Module | Description |
|--------|-------------|
| `nodeReaders.js` | Document info, selection, node info, read design |
| `nodeCreators.js` | Create rectangle, frame, text, clone nodes |
| `nodeModifiers.js` | Move, resize, delete, select nodes |
| `stylingHandlers.js` | Fill color, stroke color, corner radius |
| `layoutHandlers.js` | Auto-layout (mode, padding, alignment, sizing, spacing) |
| `componentHandlers.js` | Styles, components, instances, exports, overrides |
| `connectorHandlers.js` | Reactions, connectors, connections |
| `textHandlers.js` | Text scanning and modification |
| `annotationHandlers.js` | Annotations and node type scanning |

## Utility Modules

| Module | Description |
|--------|-------------|
| `colorUtils.js` | Color conversion (RGBA to hex) |
| `progressUtils.js` | Command ID generation, progress updates |
| `exportUtils.js` | Base64 encoding for exports |
| `helpers.js` | General helpers (uniqBy, delay) |
| `textUtils.js` | Font handling, text character operations |
| `nodeUtils.js` | Node filtering and collection |

## Development Workflow

1. Make changes to files in `src/`, `handlers/`, or `utils/`
2. Run `npm run plugin:build` to generate the bundled `code.js`
3. The Figma plugin will automatically pick up the new `dist/code.js`

For development with auto-rebuild:
```bash
npm run plugin:watch
```

## Notes

- The `dist/code.js` file is auto-generated and should not be edited directly
- All source changes should be made in the modular files
- The build process uses esbuild for fast bundling
